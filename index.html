<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>大贸商跨境物流业务流程对比 - 优化版</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.3/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 8px 8px 0 0;
        }
        h1 {
            text-align: center;
            margin: 0;
            font-size: 24px;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .node-details {
            display: none;
            margin: 20px auto;
            padding: 15px;
            background-color: #e9f7ef;
            border-radius: 8px;
            border-left: 5px solid #27ae60;
            max-width: 800px;
        }
        .key-node {
            background-color: #f1c40f !important;
        }
        .feature-box {
            margin: 15px 0;
            padding: 15px;
            background-color: #e8f6fc;
            border-radius: 8px;
            border-left: 5px solid #3498db;
        }
        .feature-title {
            margin-top: 0;
            color: #2c3e50;
        }
        .flow-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .flow-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        .flow-container:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .flow-title {
            font-weight: bold;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        .original-title {
            background-color: #fdf2f8; /* 粉色背景 */
        }
        .new-title {
            background-color: #ecfdf5; /* 绿色背景 */
        }
        .flow-title:after {
            content: '▼';
            margin-left: 10px;
            font-size: 12px;
        }
        .flow-title.collapsed:after {
            content: '►';
        }
        .comparison-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .comparison-column {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        .comparison-column h3 {
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            margin-top: 0;
        }
        .comparison-column ul {
            padding-left: 20px;
        }
        .comparison-column li {
            margin: 8px 0;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .highlight {
            animation: highlight 2s ease-in-out;
        }
        @keyframes highlight {
            0% { background-color: rgba(255, 255, 0, 0.5); }
            100% { background-color: transparent; }
        }
        .highlight-item {
            font-weight: bold;
            position: relative;
        }
        .highlight-item:before {
            content: '★';
            position: absolute;
            left: -15px;
            color: #e74c3c;
        }
        .compare {
            margin-top: 30px;
            padding: 20px;
            background: #fffaf0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .compare h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #f1c40f;
            padding-bottom: 10px;
            display: inline-block;
        }
        .compare-points {
            list-style-type: none;
            padding: 0;
        }
        .compare-points li {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border-left: 3px solid transparent;
        }
        .compare-points li:hover {
            background-color: #e8f4f8;
            border-left-color: #3498db;
        }
        .compare-points li strong {
            color: #e74c3c;
        }
        .node-highlight {
            animation: pulse 1s infinite;
            stroke-width: 3px !important;
            stroke: #f39c12 !important;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        /* 响应式调整 */
        @media (max-width: 1024px) {
            .flow-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
        }
        @media (max-width: 600px) {
            .comparison-container {
                grid-template-columns: 1fr;
            }
            .controls {
                flex-direction: column;
                align-items: center;
            }
            button {
                width: 100%;
                margin: 5px 0;
            }
        }
        /* 保证流程图区域能更好地显示 */
        .mermaid {
            display: flex;
            justify-content: center;
            overflow-x: auto;
            margin: 0 auto;
            max-width: 100%;
        }
        /* 美化节点详情样式 */
        #node-title {
            color: #27ae60;
            margin-top: 0;
        }
        #node-description {
            line-height: 1.6;
        }
        .direct-shipping-btn {
            background-color: #e74c3c;
        }
        .direct-shipping-btn:hover {
            background-color: #c0392b;
        }
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            z-index: 1000;
            pointer-events: none;
            font-size: 14px;
            max-width: 250px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>大贸商跨境物流业务流程对比</h1>
        </div>
        
        <div class="controls">
            <button id="highlight-diff">高亮差异点</button>
            <button id="show-side-by-side">并排文本比较</button>
            <button id="reset-view">重置视图</button>
            <button id="direct-shipping-btn" class="direct-shipping-btn">查看直接发货链路</button>
        </div>
        
        <div id="node-details" class="node-details">
            <h3 id="node-title">节点详情</h3>
            <p id="node-description">点击流程图中的节点查看详细信息。</p>
        </div>
        
        <div id="main-view">
            <div class="flow-grid">
                <div class="flow-container">
                    <div class="flow-title original-title" data-target="original-flow">原始贸易模式</div>
                    <div id="original-flow" class="flow-content">
                        <div class="mermaid">
                            graph TD
                            A1[大贸商购买国外商品] --> B1[货代公司国际运输]
                            B1 --> C1[进入港口]
                            C1 --> D1[申报清关]
                            D1 --> E1{是否为食品?}
                            E1 -->|是| F1[港内检验检疫]
                            F1 --> G1[清关完成]
                            E1 -->|否| G1
                            G1 --> H1[国内物流运输]
                            H1 --> I1[批发商/小B端]
                            I1 --> J1[零售至C端]
                            
                            click A1 callback
                            click B1 callback
                            click C1 callback
                            click D1 callback
                            click E1 callback
                            click F1 callback
                            click G1 callback
                            click H1 callback
                            click I1 callback
                            click J1 callback
                            
                            style A1 fill:#f9d5e5,stroke:#333
                            style B1 fill:#f9d5e5,stroke:#333
                            style C1 fill:#f9d5e5,stroke:#333
                            style D1 fill:#f9d5e5,stroke:#333
                            style E1 fill:#f9d5e5,stroke:#333
                            style F1 fill:#f9d5e5,stroke:#333
                            style G1 fill:#f9d5e5,stroke:#333
                            style H1 fill:#f9d5e5,stroke:#333
                            style I1 fill:#f9d5e5,stroke:#333
                            style J1 fill:#f9d5e5,stroke:#333
                        </div>
                    </div>
                </div>
                
                <div class="flow-container">
                    <div class="flow-title new-title" data-target="new-flow">新型贸易模式</div>
                    <div id="new-flow" class="flow-content">
                        <div class="mermaid">
                            graph TD
                            A2[大贸商购买国外商品] --> B2[进入中通保税仓]
                            B2 --> C2[中通提供仓储服务]
                            C2 --> D2[C端预售模式]
                            D2 --> E2[商品预售出去]
                            E2 --> F2[货代公司申报清关]
                            F2 --> G2{是否为食品?}
                            G2 -->|是| H2[港内检验检疫]
                            H2 --> I2[清关完成]
                            G2 -->|否| I2
                            I2 --> J2[中通保税仓下架打包]
                            J2 --> K2[直接发货到C端]
                            
                            click A2 callback
                            click B2 callback
                            click C2 callback
                            click D2 callback
                            click E2 callback
                            click F2 callback
                            click G2 callback
                            click H2 callback
                            click I2 callback
                            click J2 callback
                            click K2 callback
                            
                            style A2 fill:#d5f5e3,stroke:#333
                            style B2 fill:#d5f5e3,stroke:#333
                            style C2 fill:#d5f5e3,stroke:#333
                            style D2 fill:#d5f5e3,stroke:#333
                            style E2 fill:#d5f5e3,stroke:#333
                            style F2 fill:#d5f5e3,stroke:#333
                            style G2 fill:#d5f5e3,stroke:#333
                            style H2 fill:#d5f5e3,stroke:#333
                            style I2 fill:#d5f5e3,stroke:#333
                            style J2 fill:#d5f5e3,stroke:#333
                            style K2 fill:#d5f5e3,stroke:#333
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="side-by-side" class="comparison-container" style="display:none">
            <div class="comparison-column">
                <h3>原始业务流程</h3>
                <ul>
                    <li data-node="A1">大贸商购买国外商品</li>
                    <li data-node="B1">货代公司国际运输</li>
                    <li data-node="C1">进入港口</li>
                    <li data-node="D1">申报清关</li>
                    <li data-node="E1">是否为食品?</li>
                    <li data-node="F1">港内检验检疫（食品）</li>
                    <li data-node="G1">清关完成</li>
                    <li data-node="H1">国内物流运输</li>
                    <li data-node="I1" class="highlight-item">批发商/小B端中转</li>
                    <li data-node="J1">零售至C端</li>
                </ul>
            </div>
            <div class="comparison-column">
                <h3>新型业务流程</h3>
                <ul>
                    <li data-node="A2">大贸商购买国外商品</li>
                    <li data-node="B2" class="highlight-item">进入中通保税仓</li>
                    <li data-node="C2">中通提供仓储服务</li>
                    <li data-node="D2" class="highlight-item">C端预售模式</li>
                    <li data-node="E2">商品预售出去</li>
                    <li data-node="F2">货代公司申报清关</li>
                    <li data-node="G2">是否为食品?</li>
                    <li data-node="H2">港内检验检疫（食品）</li>
                    <li data-node="I2">清关完成</li>
                    <li data-node="J2">中通保税仓下架打包</li>
                    <li data-node="K2" class="highlight-item">直接发货到C端</li>
                </ul>
            </div>
        </div>
        
        <div class="feature-box" id="direct-shipping-feature" style="display:none">
            <h3 class="feature-title">直接发货到C端 - 新模式的核心优势</h3>
            <p>新型业务模式最大的优势是直接从中通保税仓发货到C端消费者，无需经过批发商/小B端中转。这大大缩短了物流链路，降低了成本，提高了效率。</p>
            <div style="margin-top:10px;padding:10px;background-color:#f8f9f9;border-left:4px solid #3498db;border-radius:4px;">
                <p><strong>原始模式：</strong> 港口→国内物流→批发商/小B端→零售至C端</p>
                <p><strong>新型模式：</strong> 中通保税仓→直接发货到C端</p>
            </div>
        </div>
        
        <div class="compare">
            <h2>业务模式对比要点：</h2>
            <ul class="compare-points">
                <li data-diff="channel"><strong>渠道差异：</strong>原始模式需经过批发商(小B端)中转，新型模式直接从保税仓到C端</li>
                <li data-diff="timing"><strong>销售时机：</strong>新型模式支持商品到岸前预售，原始模式需等货物清关后才能销售</li>
                <li data-diff="storage"><strong>仓储管理：</strong>新型模式由中通提供专业保税仓储服务</li>
                <li data-diff="efficiency"><strong>效率提升：</strong>新型模式减少中间环节，优化供应链</li>
                <li data-diff="integration"><strong>物流整合：</strong>新型模式整合保税仓储与物流配送，形成一站式服务</li>
            </ul>
        </div>
    </div>
    
    <div id="tooltip" class="tooltip"></div>
    
    <script>
        // 配置Mermaid
        mermaid.initialize({
            startOnLoad: true,
            securityLevel: 'loose',
            theme: 'default'
        });
        
        // 节点详情数据
        const nodeData = {
            "A1": { title: "大贸商购买国外商品", description: "大贸商从海外供应商处采购商品，是跨境贸易的起点。" },
            "B1": { title: "货代公司国际运输", description: "货代公司负责将商品从国外运输到国内港口，包括安排国际物流、船期等。" },
            "C1": { title: "进入港口", description: "商品抵达国内港口，准备进行海关申报和清关。" },
            "D1": { title: "申报清关", description: "向海关申报商品信息，缴纳关税等费用。" },
            "E1": { title: "是否为食品?", description: "判断商品类型，食品类商品需要进行额外的检验检疫。" },
            "F1": { title: "港内检验检疫", description: "食品类商品需要经过检验检疫部门的检查，确保安全达标。" },
            "G1": { title: "清关完成", description: "商品完成所有海关手续，获准入境。" },
            "H1": { title: "国内物流运输", description: "通过国内物流渠道将商品从港口运输到批发商仓库。" },
            "I1": { title: "批发商/小B端", description: "商品先到批发商/小B端仓库，由批发商分销。这是原始模式的中间环节。" },
            "J1": { title: "零售至C端", description: "批发商将商品分销给零售商，最终到达消费者手中。" },
            
            "A2": { title: "大贸商购买国外商品", description: "大贸商从海外供应商处采购商品，是跨境贸易的起点。" },
            "B2": { title: "进入中通保税仓", description: "商品直接进入中通的保税仓库，享受保税政策，无需先完成清关。" },
            "C2": { title: "中通提供仓储服务", description: "中通在保税区内提供专业的仓储管理服务，包括库存管理、分拣等。" },
            "D2": { title: "C端预售模式", description: "新型模式的关键环节，在商品实际到港前就可以向C端消费者预售。" },
            "E2": { title: "商品预售出去", description: "C端消费者在商品尚未清关前就完成了购买。" },
            "F2": { title: "货代公司申报清关", description: "针对已售商品，货代公司进行集中申报清关，提高效率。" },
            "G2": { title: "是否为食品?", description: "判断商品类型，食品类商品需要进行额外的检验检疫。" },
            "H2": { title: "港内检验检疫", description: "食品类商品需要经过检验检疫部门的检查，确保安全达标。" },
            "I2": { title: "清关完成", description: "商品完成所有海关手续，获准入境。" },
            "J2": { title: "中通保税仓下架打包", description: "已清关商品从保税仓下架，按订单进行打包处理。" },
            "K2": { title: "直接发货到C端", description: "商品直接从中通保税仓发货到C端消费者手中，无中间批发环节。" }
        };
        
        // 差异点映射
        const diffMapping = {
            "channel": ["I1", "K2"],
            "timing": ["D2", "E2"],
            "storage": ["B2", "C2"],
            "efficiency": ["I1", "J2", "K2"],
            "integration": ["B2", "J2", "K2"]
        };
        
        // 回调函数
        window.callback = function(nodeId) {
            const data = nodeData[nodeId];
            if (data) {
                document.getElementById("node-title").textContent = data.title;
                document.getElementById("node-description").textContent = data.description;
                document.getElementById("node-details").style.display = "block";
                
                // 滚动到详情区域
                document.getElementById("node-details").scrollIntoView({behavior: "smooth"});
                
                // 查找并高亮SVG中的节点
                highlightSvgNode(nodeId);
            }
        };
        
        // 高亮SVG中的节点
        function highlightSvgNode(nodeId) {
            // 等待确保Mermaid图表已完全渲染
            setTimeout(() => {
                // 寻找ID对应的节点
                const nodes = document.querySelectorAll(`.mermaid g.node`);
                
                for (const node of nodes) {
                    const text = node.querySelector("text");
                    if (text && text.textContent.includes(nodeData[nodeId].title)) {
                        // 获取节点的rect或polygon元素
                        const shape = node.querySelector("rect, polygon, circle, path");
                        if (shape) {
                            // 添加高亮动画类
                            shape.classList.add("node-highlight");
                            
                            // 2秒后移除高亮效果
                            setTimeout(() => {
                                shape.classList.remove("node-highlight");
                            }, 3000);
                        }
                        
                        // 跳出循环，不再继续查找
                        break;
                    }
                }
            }, 100);
        }
        
        // 显示直接发货功能提示
        function showDirectShippingFeature() {
            // 隐藏节点详情
            document.getElementById("node-details").style.display = "none";
            
            // 显示直接发货功能提示
            const directShippingFeature = document.getElementById("direct-shipping-feature");
            directShippingFeature.style.display = "block";
            
            // 滚动到功能提示区域
            directShippingFeature.scrollIntoView({behavior: "smooth"});
            
            // 高亮小B端和直接发货到C端节点，显示对比
            const diffNodes = ["I1", "K2"];
            diffNodes.forEach(nodeId => {
                highlightSvgNode(nodeId);
            });
        }
        
        // 文档加载完成后
        document.addEventListener("DOMContentLoaded", function() {
            // 流程标题点击处理
            document.querySelectorAll(".flow-title").forEach(title => {
                title.addEventListener("click", function() {
                    const targetId = this.getAttribute("data-target");
                    const target = document.getElementById(targetId);
                    if (target.style.display === "none") {
                        target.style.display = "block";
                        this.classList.remove("collapsed");
                    } else {
                        target.style.display = "none";
                        this.classList.add("collapsed");
                    }
                });
            });
            
            // 高亮差异点按钮
            document.getElementById("highlight-diff").addEventListener("click", function() {
                const diffNodes = ["I1", "B2", "D2", "K2"];
                
                // 在节点详情中显示差异点说明
                document.getElementById("node-title").textContent = "主要业务差异点";
                document.getElementById("node-description").textContent = 
                    "1. 新模式引入中通保税仓，替代了原模式中的批发商/小B端环节\n" +
                    "2. 新模式支持C端预售，原模式需等清关后才能销售\n" +
                    "3. 新模式通过保税仓直发C端，减少中间环节，降低成本（免进口关税、免中间差价），实现物流链路优化";
                document.getElementById("node-details").style.display = "block";
                
                // 高亮差异节点
                diffNodes.forEach(nodeId => {
                    highlightSvgNode(nodeId);
                });
            });
            
            // 并排比较按钮
            document.getElementById("show-side-by-side").addEventListener("click", function() {
                const mainView = document.getElementById("main-view");
                const sideView = document.getElementById("side-by-side");
                const directShippingFeature = document.getElementById("direct-shipping-feature");
                
                if (sideView.style.display === "none") {
                    mainView.style.display = "none";
                    sideView.style.display = "grid";
                    directShippingFeature.style.display = "none";
                    this.textContent = "返回流程图";
                } else {
                    sideView.style.display = "none";
                    mainView.style.display = "block";
                    this.textContent = "并排文本比较";
                }
            });
            
            // 重置视图按钮
            document.getElementById("reset-view").addEventListener("click", function() {
                document.getElementById("main-view").style.display = "block";
                document.getElementById("side-by-side").style.display = "none";
                document.getElementById("direct-shipping-feature").style.display = "none";
                document.getElementById("show-side-by-side").textContent = "并排文本比较";
                document.getElementById("node-details").style.display = "none";
                
                document.querySelectorAll(".flow-content").forEach(content => {
                    content.style.display = "block";
                });
                
                document.querySelectorAll(".flow-title").forEach(title => {
                    title.classList.remove("collapsed");
                });
            });
            
            // 直接发货链路按钮
            document.getElementById("direct-shipping-btn").addEventListener("click", function() {
                showDirectShippingFeature();
            });
            
            // 比较要点交互
            document.querySelectorAll(".compare-points li").forEach(point => {
                point.addEventListener("click", function() {
                    const diffType = this.getAttribute("data-diff");
                    const relatedNodes = diffMapping[diffType] || [];
                    
                    // 高亮相关节点
                    relatedNodes.forEach(nodeId => {
                        highlightSvgNode(nodeId);
                    });
                    
                    // 高亮当前点击的比较要点
                    this.classList.add("highlight");
                    setTimeout(() => this.classList.remove("highlight"), 2000);
                    
                    // 显示相关解释
                    document.getElementById("node-title").textContent = 
                        this.querySelector("strong").textContent;
                    document.getElementById("node-description").textContent = 
                        this.textContent.replace(this.querySelector("strong").textContent, "").trim();
                    document.getElementById("node-details").style.display = "block";
                });
            });
        });
    </script>
</body>
</html>